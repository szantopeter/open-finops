<div class="monthly-cost-chart">

  <div *ngIf="error" class="error">{{ error }}</div>
  <div *ngIf="aggregator?.lastUnmatchedCount && aggregator.lastUnmatchedCount > 0" class="unmatched-list">
    <h3>Unmatched import rows ({{ aggregator.lastUnmatchedCount }})</h3>
    <p>The following import rows could not be matched to a pricing record. Each entry shows the composite key and a breakdown of the fields used for matching.</p>
    <ol>
      <li *ngFor="let s of aggregator.lastUnmatchedSamples">
        <strong>{{ s.key }}</strong>
        <ul>
          <li><strong>instanceClass:</strong> {{ s.row.instanceClass }} — the RDS instance type (e.g. db.r5.xlarge)</li>
          <li><strong>region:</strong> {{ s.row.region }} — AWS region code (e.g. eu-west-1)</li>
          <li><strong>multiAz:</strong> {{ s.row.multiAz }} — whether the RI is Multi-AZ (true means Multi-AZ / high-availability, false means single-AZ)</li>
          <li><strong>engine:</strong> {{ s.row.engine }} — database engine token (normalized; may include edition suffixes like <code>oracle-se2</code>)</li>
          <li><strong>edition:</strong> {{ s.row.edition }} — edition/license token when present (null means no edition)</li>
          <li><strong>upfrontPayment:</strong> {{ s.row.upfrontPayment }} — payment option: No Upfront, Partial Upfront, All Upfront</li>
          <li><strong>durationMonths:</strong> {{ s.row.durationMonths }} — RI term length in months (12 or 36)</li>
          <li><strong>startDate:</strong> {{ s.row.startDate }} — reservation start date</li>
          <li><strong>endDate:</strong> {{ s.row.endDate }} — reservation end date (null = still active)</li>
          <li><strong>count:</strong> {{ s.row.count }} — number of identical RIs represented by this row</li>
        </ul>
      </li>
    </ol>
    <p>If many rows are unmatched, consider checking the pricing files under <code>/assets/pricing/</code> or normalizing engine/edition tokens (e.g. remove <code>(byol)</code> parenthesis or convert <code>oracle-se2 (byol)</code> → <code>oracle-se2-byol</code>).</p>
  </div>
  <div *ngIf="missingPricing && missingPricing.length > 0" class="missing-list">
    <h3>Missing pricing files</h3>
    <p>The following pricing files were not found under <code>/assets/pricing/</code>. These files are required to calculate costs for some RIs.</p>
    <ul>
      <li *ngFor="let p of missingPricing">{{ p }}</li>
    </ul>
  </div>
  <div *ngIf="!data && !error" class="empty">No reservation data available for the selected period.</div>
  <div *ngIf="data" class="chart-container">
    <!-- ECharts will be initialized here -->
    <div id="monthly-cost-chart-root" style="width:100%;height:600px;"></div>
  </div>
</div>
