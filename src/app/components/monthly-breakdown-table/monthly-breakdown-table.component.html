<!-- Monthly Breakdown Table -->
@if (expandedRow) {
<div class="monthly-breakdown">
  <h4>Monthly Cost Breakdown for {{ getScenarioName(expandedRow) }}</h4>
  <div class="filter-controls">
  </div>
  <div class="table-container">
    <table class="monthly-breakdown-table">
      <thead>
        <tr>
          <th rowspan="2" scope="col" class="year-month-cell">Year-Month</th>
          @for (scenario of displayedScenarios; track scenario) {
            @if (scenario === 'onDemand') {
              <th scope="col">{{ getScenarioName(scenario) }}</th>
            } @else {
              <th colspan="4" scope="col">{{ getScenarioName(scenario) }}</th>
            }
          }
        </tr>
        <tr>
          @for (scenario of displayedScenarios; track scenario) {
            <th scope="col">Monthly fees</th>
            @if (scenario !== 'onDemand') {
              <th scope="col">Upfront fees</th>
              <th scope="col">Total Monthly Spend</th>
              <th scope="col">Adjusted Amortised</th>
            }
          }
        </tr>
      </thead>
      <tbody>
        @for (ym of getYearMonths(); track ym.year + '-' + ym.month) {
          <tr [class.highestSpendMonth]="isHighestSpendMonth(ym.year, ym.month)">
            <td class="year-month-cell">{{ ym.year }}-{{ ym.month.toString().padStart(2, '0') }}</td>
            @for (scenario of displayedScenarios; track scenario) {
              <td class="currency-cell" [class.zero-value]="isZeroValue(getMonthlyCost(scenario, ym.year, ym.month))">{{ formatCurrency(getMonthlyCost(scenario, ym.year, ym.month)) }}</td>
              @if (scenario !== 'onDemand') {
                <td class="currency-cell" [class.zero-value]="isZeroValue(getUpfrontCost(scenario, ym.year, ym.month))">{{ formatCurrency(getUpfrontCost(scenario, ym.year, ym.month)) }}</td>
                <td class="currency-cell" [class.zero-value]="isZeroValue(getTotalMonthlySpend(scenario, ym.year, ym.month))">{{ formatCurrency(getTotalMonthlySpend(scenario, ym.year, ym.month)) }}</td>
                <td class="currency-cell" [class.zero-value]="isZeroValue(getAdjustedAmortised(scenario, ym.year, ym.month))">{{ formatCurrency(getAdjustedAmortised(scenario, ym.year, ym.month)) }}</td>
              }
            }
            <!-- Total column removed -->
          </tr>
        }
        <tr class="summary-row">
          <td class="year-month-cell">Total</td>
          @for (scenario of displayedScenarios; track scenario) {
            <td class="currency-cell">{{ formatCurrency(getTotalMonthlyCost(scenario)) }}</td>
            @if (scenario !== 'onDemand') {
              <td class="currency-cell">{{ formatCurrency(getTotalUpfrontCost(scenario)) }}</td>
              <td class="currency-cell">{{ formatCurrency(getTotalMonthlySpendTotal(scenario)) }}</td>
              <td class="currency-cell">{{ formatCurrency(getTotalAdjustedAmortised(scenario)) }}</td>
            }
          }
          <!-- Grand total column removed -->
        </tr>
      </tbody>
    </table>
  </div>
</div>
}
