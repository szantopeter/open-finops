<div class="cost-comparison-container" *ngIf="costComparisonsArray.length > 0">
  <h3>Cost Comparison Analysis</h3>
  <p class="subtitle">Comparing different AWS RDS Reserved Instance payment scenarios for {{ riPortfolio.metadata.firstFullYear }}</p>

  <div class="table-container">
    <h4>Reference scenarios</h4>
    <table class="cost-comparison-table">
      <thead>
        <tr>
          <th>Scenario</th>
          <th>Total Upfront</th>
          <th>Total Monthly Payment</th>
          <th>Highest monthly spend</th>
          <th>Total Adjusted Amortised</th>
          <th>Savings (Compared to On Demand)</th>
          <th>Savings (Compared to Current)</th>
          <th>Details</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let c of referenceComparisons" [class.baseline-row]="expandedRow === c.scenario">
          <td class="scenario-cell">{{ getScenarioName(c.scenario) }}</td>
          <td class="currency-cell" [class.zero-value]="isZeroValue(c.totalUpfront)">{{ formatCurrency(c.totalUpfront) }}</td>
          <td class="currency-cell" [class.zero-value]="isZeroValue(c.totalMonthlyPayment)">{{ formatCurrency(c.totalMonthlyPayment) }}</td>
          <td class="currency-cell" [class.zero-value]="isZeroValue(c.highestMonthlySpend)">{{ formatHighestMonthlySpend(c) }}</td>
          <td class="currency-cell" [class.zero-value]="isZeroValue(c.totalCost)">{{ formatCurrency(c.totalCost) }}</td>
          <td class="savings-cell" [class.savings]="c.savingsPercentOnDemand && c.savingsPercentOnDemand > 0">
            <span *ngIf="c.savingsValueOnDemand !== undefined">{{ formatCurrency(c.savingsValueOnDemand) }} ({{ formatPercent(c.savingsPercentOnDemand) }})</span>
            <span *ngIf="c.savingsValueOnDemand === undefined">-</span>
          </td>
          <td class="savings-current-cell" [class.savings]="c.savingsPercentCurrent && c.savingsPercentCurrent > 0">
            <span *ngIf="c.savingsValueCurrent !== undefined">{{ formatCurrency(c.savingsValueCurrent) }} ({{ formatPercent(c.savingsPercentCurrent) }})</span>
            <span *ngIf="c.savingsValueCurrent === undefined">-</span>
          </td>
          <td class="action-cell">
            <button class="details-button" (click)="toggleMonthlyBreakdown(c.scenario)" [class.expanded]="expandedRow === c.scenario">{{ expandedRow === c.scenario ? 'Hide' : 'Show' }} Details</button>
          </td>
        </tr>
      </tbody>
    </table>

    <h4>Savings Scenarios</h4>
    <table class="cost-comparison-table">
      <thead>
        <tr>
          <th>Scenario</th>
          <th>Total Upfront</th>
          <th>Total Monthly Payment</th>
          <th>Highest monthly spend</th>
          <th>Total Adjusted Amortised</th>
          <th>Savings (Compared to On Demand)</th>
          <th>Savings (Compared to Current)</th>
          <th>Details</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let c of savingsComparisons" [class.baseline-row]="expandedRow === c.scenario">
          <td class="scenario-cell">{{ getScenarioName(c.scenario) }}</td>
          <td class="currency-cell" [class.zero-value]="isZeroValue(c.totalUpfront)">{{ formatCurrency(c.totalUpfront) }}</td>
          <td class="currency-cell" [class.zero-value]="isZeroValue(c.totalMonthlyPayment)">{{ formatCurrency(c.totalMonthlyPayment) }}</td>
          <td class="currency-cell" [class.zero-value]="isZeroValue(c.highestMonthlySpend)">{{ formatHighestMonthlySpend(c) }}</td>
          <td class="currency-cell" [class.zero-value]="isZeroValue(c.totalCost)">{{ formatCurrency(c.totalCost) }}</td>
          <td class="savings-cell" [class.savings]="c.savingsPercentOnDemand && c.savingsPercentOnDemand > 0">
            <span *ngIf="c.savingsValueOnDemand !== undefined">{{ formatCurrency(c.savingsValueOnDemand) }} ({{ formatPercent(c.savingsPercentOnDemand) }})</span>
            <span *ngIf="c.savingsValueOnDemand === undefined">-</span>
          </td>
          <td class="savings-current-cell" [class.savings]="c.savingsPercentCurrent && c.savingsPercentCurrent > 0">
            <span *ngIf="c.savingsValueCurrent !== undefined">{{ formatCurrency(c.savingsValueCurrent) }} ({{ formatPercent(c.savingsPercentCurrent) }})</span>
            <span *ngIf="c.savingsValueCurrent === undefined">-</span>
          </td>
          <td class="action-cell">
            <button class="details-button" (click)="toggleMonthlyBreakdown(c.scenario)" [class.expanded]="expandedRow === c.scenario">{{ expandedRow === c.scenario ? 'Hide' : 'Show' }} Details</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Monthly Breakdown Table -->
  <app-monthly-breakdown-table
    [expandedRow]="expandedRow"
    [timeseries]="currentComparison?.monthlyBreakdown || []"
    [firstFullYear]="riPortfolio.metadata.firstFullYear"
    [highestSpendMonth]="currentComparison?.highestMonthlySpendMonth" #monthlyBreakdown>
  </app-monthly-breakdown-table>
</div>

<div class="no-data" *ngIf="costComparisonsArray.length === 0">
  <p>No cost comparison data available. Please import RI portfolio data first.</p>
</div>
