<div class="cost-comparison-container" *ngIf="costComparisonsArray.length > 0">
  <h3>Cost Comparison Analysis</h3>
  <p class="subtitle">Comparing different AWS RDS Reserved Instance payment options for {{ riPortfolio.metadata.firstFullYear }}</p>

  <div class="table-container">
    <table class="cost-comparison-table">
      <thead>
        <tr>
          <th>Scenario</th>
          <th>Total Upfront</th>
          <th>Total Monthly Payment</th>
          <th>Highest monthly spend</th>
          <th>Total Cost</th>
          <th>Savings Percent</th>
          <th>Details</th>
        </tr>
      </thead>
      <tbody>
        @for (comparison of costComparisonsArray; track comparison.scenario) {
          <tr [class.baseline-row]="expandedRow === comparison.scenario">
            <td class="scenario-cell">{{ getScenarioName(comparison.scenario) }}</td>
            <td class="currency-cell" [class.zero-value]="isZeroValue(comparison.totalUpfront)">{{ formatCurrency(comparison.totalUpfront) }}</td>
            <td class="currency-cell" [class.zero-value]="isZeroValue(comparison.totalMonthlyPayment)">{{ formatCurrency(comparison.totalMonthlyPayment) }}</td>
            <td class="currency-cell" [class.zero-value]="isZeroValue(comparison.highestMonthlySpend)">{{ formatHighestMonthlySpend(comparison) }}</td>
            <td class="currency-cell" [class.zero-value]="isZeroValue(comparison.totalCost)">{{ formatCurrency(comparison.totalCost) }}</td>
            <td class="percent-cell" [class.savings]="comparison.savingsPercent && comparison.savingsPercent > 0">
              {{ formatPercent(comparison.savingsPercent) }}
            </td>
            <td class="action-cell">
              <button 
                class="details-button" 
                (click)="toggleMonthlyBreakdown(comparison.scenario)"
                [class.expanded]="expandedRow === comparison.scenario">
                {{ expandedRow === comparison.scenario ? 'Hide' : 'Show' }} Details
              </button>
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>

  <!-- Monthly Breakdown Table -->
  <app-monthly-breakdown-table
    [expandedRow]="expandedRow"
    [timeseries]="currentComparison?.monthlyBreakdown || []"
    [firstFullYear]="riPortfolio.metadata.firstFullYear"
    [highestSpendMonth]="currentComparison?.highestMonthlySpendMonth">
  </app-monthly-breakdown-table>
</div>

<div class="no-data" *ngIf="costComparisonsArray.length === 0">
  <p>No cost comparison data available. Please import RI portfolio data first.</p>
</div>
